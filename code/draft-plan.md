# HRMS Monorepo Base Structure — Project Scaffold

## TL;DR

> **Quick Summary**: Set up a production-ready Bun monorepo for the HRMS (Human Resource Management System) of Thuy Loi University, with ElysiaJS backend, React + Shadcn UI frontend, and shared TypeScript packages — all wired together with end-to-end type safety via Eden Treaty. Includes full Drizzle ORM schema conversion of all 30 database tables.
>
> **Deliverables**:
> - Complete monorepo folder structure with Bun workspaces
> - Backend skeleton: ElysiaJS + Drizzle ORM (ALL 30 tables converted) + better-auth DB session auth (HTTP-only cookie, 30-min sliding expiration)
> - Frontend skeleton: Vite + React + TanStack Router + Shadcn UI + Tailwind CSS v4 (vi locale)
> - Shared package: TypeScript types + Zod validators
> - Dev tooling: Turborepo, Biome, TypeScript project references
> - VS Code workspace settings
>
> **Estimated Effort**: Medium-Large (6-10 hours)
> **Parallel Execution**: YES — 3 waves
> **Critical Path**: Task 1 (root infra) → Tasks 2,3,4 (parallel packages) → Task 5 (integration)

---

## Context

### Original Request
Build the base monorepo structure for an HRMS application serving Thuy Loi University. The project needs ElysiaJS backend, React SPA frontend, and shared code between them. Focus on folder organization, config files, library selection, and development workflow — no feature implementation.

### Interview Summary
**Key Discussions**:
- User provided comprehensive requirements document (`Yeu cau khach hang.md`) with 11 stakeholder requirements → 40+ features
- Database schema already exists (`database/schema.postgres.sql` — 30 tables, 555 lines, PostgreSQL)
- 4 user roles: ADMIN, TCCB (HR), TCKT (Finance), EMPLOYEE
- Vietnamese-only interface, on-premise deployment, 500 concurrent users
- **UI Framework**: User chose **Shadcn UI** (Radix UI + Tailwind CSS v4) over Ant Design
- **Drizzle Schema**: User chose **full conversion** of ALL 30 tables (not just auth tables)
- **Frontend Approach**: Fresh start — ignore existing `fe/tlu-hr/` app (85 commits)
- **Tests**: No test infrastructure in scaffold phase

**Research Findings**:
- **ElysiaJS**: Plugin-based modular architecture, guard patterns for route groups, Eden Treaty for end-to-end type safety
- **Drizzle ORM**: Multi-file schema organization by domain, `casing: 'snake_case'` for auto-mapping, migrations via `drizzle-kit`, postgres-js driver recommended for Bun
- **TanStack Router**: File-based routing with Vite plugin (`@tanstack/router-plugin/vite`), `createFileRoute` pattern, route context for auth injection
- **Shadcn UI**: Components copied into project (`src/components/ui/`), requires Tailwind CSS v4 (`@tailwindcss/vite` plugin, CSS-only config with `@import "tailwindcss"`), no `tailwind.config.js` needed. Forms use react-hook-form + `@hookform/resolvers/zod`. Vietnamese dates via `date-fns` with `vi` locale. `components.json` config generated by `shadcn init`.
- **Zustand**: Slices pattern for domain separation, `devtools` middleware
- **Bun Workspaces**: `workspace:*` protocol, shared package via `exports` field
- **Turborepo**: `dependsOn: ["^build"]` for dependency-aware task orchestration
- **Biome**: `extends: "//"` for monorepo configs, replaces ESLint + Prettier

### Metis Review
**Identified Gaps** (addressed):
- UI framework → **Decision**: Shadcn UI + Tailwind CSS v4 (user's explicit choice)
- Drizzle schema scope → **Decision**: Full conversion of ALL tables (user's explicit choice)
- Test infrastructure → **Decision**: Not included in scaffold scope
- `.env` handling → **Decision**: Include `.env.example` with documented variables, no actual `.env`
- Git strategy → **Decision**: Build monorepo structure within existing `code/` git repo
- Zod version → **Decision**: Use Zod v3 (stable, widely supported, most Drizzle/ElysiaJS ecosystem compatibility)

---

## Work Objectives

### Core Objective
Create a fully working monorepo scaffold where `bun install && bun run dev` starts both backend and frontend servers, with shared types flowing end-to-end through Eden Treaty.

### Concrete Deliverables
- Root monorepo configuration (5 files)
- `apps/backend/` — ElysiaJS application skeleton with FULL Drizzle schema (30 tables) (15+ files)
- `apps/frontend/` — React SPA skeleton with Shadcn UI + Tailwind CSS v4 (15+ files)
- `packages/shared/` — Shared types and validators (5+ files)
- `.vscode/` — Workspace settings (1 file)
- `.env.example` — Environment variable template

### Definition of Done
- [ ] `bun install` completes without errors
- [ ] `bun run dev` starts both backend (port 3000) and frontend (port 5173)
- [ ] `bun run type-check` passes across all workspaces
- [ ] `bun run lint` passes with zero errors
- [ ] `bun run build` completes for all packages
- [ ] Shared types are importable from both backend and frontend
- [ ] Eden Treaty client compiles without type errors

### Must Have
- Bun workspaces with `workspace:*` references
- Turborepo task orchestration
- Biome linter/formatter (NOT ESLint/Prettier)
- TypeScript strict mode with project references
- ElysiaJS with plugin architecture (auth, CORS, swagger)
- better-auth integration for **DB-session-based auth** (NO JWT):
  - Sessions stored in `session` table in the database (managed by better-auth)
  - Secure, HTTP-only cookie (`__session`) for session token delivery
  - **Strict 30-minute sliding expiration (idle timeout)**: every authenticated request resets the 30-minute timer; if the user is idle for 30 minutes, the session is destroyed in the DB and the cookie is cleared
  - better-auth handles session creation, validation, renewal, and destruction
- Drizzle ORM with ALL 30 tables converted from `database/schema.postgres.sql`
- TanStack Router file-based routing with Vite plugin
- Shadcn UI initialized with `components.json` + Tailwind CSS v4
- react-hook-form + `@hookform/resolvers/zod` for form handling
- `date-fns` with `vi` locale for Vietnamese date formatting
- Zustand store skeleton with slices pattern
- Eden Treaty type-safe API client wired to backend types
- `.env.example` with DATABASE_URL, BETTER_AUTH_SECRET, PORT variables
- Pinned dependency versions in all package.json files

### Must NOT Have (Guardrails)
- ❌ No business logic in route handlers (placeholder responses only)
- ❌ No database migration execution (config files yes, `drizzle-kit push` no)
- ❌ No Ant Design (pure Shadcn UI + Tailwind CSS v4)
- ❌ No `tailwind.config.js` (Tailwind v4 uses CSS-only config)
- ❌ No Docker/docker-compose files
- ❌ No CI/CD pipelines
- ❌ No test framework setup or test files
- ❌ No README.md per subdirectory (root README only)
- ❌ No JSDoc on empty skeleton files
- ❌ No utility functions that aren't needed yet (`formatDate`, `capitalize`, etc.)
- ❌ No error handling middleware beyond basic structure
- ❌ No custom hooks in shared package (premature abstraction)
- ❌ No seed data scripts or fixtures
- ❌ No logging infrastructure beyond console.log
- ❌ No multiple theme variants
- ❌ No i18n system (just Vietnamese locale on date-fns + Shadcn components)
- ❌ No WebSocket setup
- ❌ No file upload handling
- ❌ No API rate limiting
- ❌ No more than 2-3 example routes per app
- ❌ No actual password hashing logic (structure only — better-auth handles this internally)
- ❌ No JWT tokens — sessions are DB-stored and delivered via HTTP-only cookies only

---

## Target Folder Structure

```
code/
├── package.json                    # Root workspace config
├── bun.lock                        # Generated by bun install
├── turbo.json                      # Turborepo task config
├── biome.json                      # Biome linter/formatter config
├── tsconfig.json                   # Base TypeScript config
├── .env.example                    # Environment variable template
├── .gitignore                      # Git ignore rules
├── .vscode/
│   └── settings.json               # Biome formatter, editor settings
├── database/
│   ├── schema.md                   # (existing — DO NOT TOUCH)
│   └── schema.postgres.sql         # (existing — DO NOT TOUCH)
├── apps/
│   ├── backend/
│   │   ├── package.json
│   │   ├── tsconfig.json
│   │   ├── drizzle.config.ts       # Drizzle Kit configuration
│   │   └── src/
│   │       ├── index.ts            # ElysiaJS app entry point
│   │       ├── db/
│   │       │   ├── index.ts        # Database connection (drizzle + postgres-js)
│   │       │   └── schema/
│   │       │       ├── index.ts    # Barrel export of all schemas
│   │       │       ├── files.ts    # files table
│   │       │       ├── campuses.ts # campuses table
│   │       │       ├── organization.ts  # org_units, org_unit_status_events
│   │       │       ├── salary.ts   # salary_coefficients, allowance_types
│   │       │       ├── employees.ts     # employees + all sub-entity tables (11 tables)
│   │       │       ├── contracts.ts     # contract_types, employment_contracts, contract_appendices
│   │       │       ├── evaluations.ts   # employee_evaluations
│   │       │       ├── training.ts      # training_course_types, training_courses, training_registrations, training_results
│   │       │       ├── auth.ts     # auth_users, auth_roles, auth_user_roles, auth_sessions
│   │       │       └── audit.ts    # audit_logs
│   │       ├── plugins/
│   │       │   ├── auth.ts         # better-auth session plugin (DB sessions + HTTP-only cookie + 30-min sliding expiry)
│   │       │   └── db.ts           # Database plugin (inject db into context)
│   │       └── routes/
│   │           ├── index.ts        # Route barrel / health check
│   │           └── auth.ts         # Auth route example (login placeholder)
│   └── frontend/
│       ├── package.json
│       ├── tsconfig.json
│       ├── tsconfig.app.json
│       ├── tsconfig.node.json
│       ├── vite.config.ts
│       ├── index.html
│       ├── components.json         # Shadcn UI config (generated by shadcn init)
│       └── src/
│           ├── main.tsx            # App entry, providers, router
│           ├── app.css             # Global CSS (Tailwind v4 imports + @theme inline)
│           ├── lib/
│           │   └── utils.ts        # cn() utility (clsx + tailwind-merge)
│           ├── api/
│           │   └── client.ts       # Eden Treaty client setup
│           ├── stores/
│           │   ├── index.ts        # Store barrel
│           │   └── auth.ts         # Auth store (Zustand slice)
│           ├── components/
│           │   └── ui/             # Shadcn UI components (added via shadcn add)
│           │       └── .gitkeep    # Placeholder (components added in later tasks)
│           ├── routes/
│           │   ├── __root.tsx      # Root layout (Shadcn ThemeProvider, base styles)
│           │   ├── index.tsx       # Home/dashboard route
│           │   └── login.tsx       # Login page route
│           └── routeTree.gen.ts    # Auto-generated by TanStack Router
├── packages/
│   └── shared/
│       ├── package.json
│       ├── tsconfig.json
│       └── src/
│           ├── index.ts            # Main barrel export
│           ├── types/
│           │   ├── index.ts        # Types barrel
│           │   ├── auth.ts         # Auth-related types (User, Role, LoginRequest/Response)
│           │   └── common.ts       # Common types (ApiResponse, PaginatedResponse)
│           └── validators/
│               ├── index.ts        # Validators barrel
│               └── auth.ts         # Auth validators (loginSchema, etc.)
```

---

## Verification Strategy (MANDATORY)

> **UNIVERSAL RULE: ZERO HUMAN INTERVENTION**
>
> ALL tasks in this plan MUST be verifiable WITHOUT any human action.
> This is NOT conditional — it applies to EVERY task, regardless of test strategy.

### Test Decision
- **Infrastructure exists**: NO
- **Automated tests**: None (out of scope for scaffold)
- **Framework**: N/A

### Agent-Executed QA Scenarios (MANDATORY — ALL tasks)

Every task includes agent-executed QA scenarios as the PRIMARY verification method.
The executing agent will directly run the deliverable and verify it using Bash commands.

**Verification Tool by Deliverable Type:**

| Type | Tool | How Agent Verifies |
|------|------|-------------------|
| Config files | Bash | `bun install`, `bun run lint`, `bun run type-check` |
| Backend skeleton | Bash | `bun run --filter @hrms/backend dev` → check server starts |
| Frontend skeleton | Playwright | Navigate to localhost:5173, verify page renders |
| Shared package | Bash | TypeScript compilation verifies imports work |
| Integration | Bash + Playwright | Full `bun run dev`, verify both servers, cross-package imports |

---