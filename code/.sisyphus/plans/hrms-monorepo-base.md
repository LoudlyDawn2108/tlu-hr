# HRMS Monorepo Base Structure — Project Scaffold

## TL;DR

> **Quick Summary**: Set up a production-ready Bun monorepo for the HRMS (Human Resource Management System) of Thuy Loi University, with ElysiaJS backend, React + Shadcn UI frontend, and shared TypeScript packages — all wired together with end-to-end type safety via Eden Treaty. Includes full Drizzle ORM schema conversion of all 30 database tables.
>
> **Deliverables**:
> - Complete monorepo folder structure with Bun workspaces
> - Backend skeleton: ElysiaJS + Drizzle ORM (ALL 30 tables converted) + better-auth DB session auth (HTTP-only cookie, 30-min sliding expiration)
> - Frontend skeleton: Vite + React + TanStack Router + Shadcn UI + Tailwind CSS v4 (vi locale)
> - Shared package: TypeScript types + Zod validators
> - Dev tooling: Turborepo, Biome, TypeScript project references
> - VS Code workspace settings
>
> **Estimated Effort**: Medium-Large (6-10 hours)
> **Parallel Execution**: YES — 3 waves
> **Critical Path**: Task 1 (root infra) → Tasks 2,3,4 (parallel packages) → Task 5 (integration)

---

## Context

### Original Request
Build the base monorepo structure for an HRMS application serving Thuy Loi University. The project needs ElysiaJS backend, React SPA frontend, and shared code between them. Focus on folder organization, config files, library selection, and development workflow — no feature implementation.

### Interview Summary
**Key Discussions**:
- User provided comprehensive requirements document (`Yeu cau khach hang.md`) with 11 stakeholder requirements → 40+ features
- Database schema already exists (`database/schema.postgres.sql` — 30 tables, 555 lines, PostgreSQL)
- 4 user roles: ADMIN, TCCB (HR), TCKT (Finance), EMPLOYEE
- Vietnamese-only interface, on-premise deployment, 500 concurrent users
- **UI Framework**: User chose **Shadcn UI** (Radix UI + Tailwind CSS v4) over Ant Design
- **Drizzle Schema**: User chose **full conversion** of ALL 30 tables (not just auth tables)
- **Frontend Approach**: Fresh start — ignore existing `fe/tlu-hr/` app (85 commits)
- **Tests**: No test infrastructure in scaffold phase

**Research Findings**:
- **ElysiaJS**: Plugin-based modular architecture, guard patterns for route groups, Eden Treaty for end-to-end type safety
- **Drizzle ORM**: Multi-file schema organization by domain, `casing: 'snake_case'` for auto-mapping, migrations via `drizzle-kit`, postgres-js driver recommended for Bun
- **TanStack Router**: File-based routing with Vite plugin (`@tanstack/router-plugin/vite`), `createFileRoute` pattern, route context for auth injection
- **Shadcn UI**: Components copied into project (`src/components/ui/`), requires Tailwind CSS v4 (`@tailwindcss/vite` plugin, CSS-only config with `@import "tailwindcss"`), no `tailwind.config.js` needed. Forms use react-hook-form + `@hookform/resolvers/zod`. Vietnamese dates via `date-fns` with `vi` locale. `components.json` config generated by `shadcn init`.
- **Zustand**: Slices pattern for domain separation, `devtools` middleware
- **Bun Workspaces**: `workspace:*` protocol, shared package via `exports` field
- **Turborepo**: `dependsOn: ["^build"]` for dependency-aware task orchestration
- **Biome**: `extends: "//"` for monorepo configs, replaces ESLint + Prettier

### Metis Review
**Identified Gaps** (addressed):
- Existing frontend at `fe/tlu-hr/` (85 commits, different stack) → **Decision**: Fresh start, new monorepo in `code/` directory. Existing app is ignored.
- UI framework → **Decision**: Shadcn UI + Tailwind CSS v4 (user's explicit choice)
- Drizzle schema scope → **Decision**: Full conversion of ALL 30 tables (user's explicit choice)
- Test infrastructure → **Decision**: Not included in scaffold scope
- `.env` handling → **Decision**: Include `.env.example` with documented variables, no actual `.env`
- Git strategy → **Decision**: Build monorepo structure within existing `code/` git repo
- Zod version → **Decision**: Use Zod v3 (stable, widely supported, most Drizzle/ElysiaJS ecosystem compatibility)

---

## Work Objectives

### Core Objective
Create a fully working monorepo scaffold where `bun install && bun run dev` starts both backend and frontend servers, with shared types flowing end-to-end through Eden Treaty.

### Concrete Deliverables
- Root monorepo configuration (5 files)
- `apps/backend/` — ElysiaJS application skeleton with FULL Drizzle schema (30 tables) (15+ files)
- `apps/frontend/` — React SPA skeleton with Shadcn UI + Tailwind CSS v4 (15+ files)
- `packages/shared/` — Shared types and validators (5+ files)
- `.vscode/` — Workspace settings (1 file)
- `.env.example` — Environment variable template

### Definition of Done
- [ ] `bun install` completes without errors
- [ ] `bun run dev` starts both backend (port 3000) and frontend (port 5173)
- [ ] `bun run type-check` passes across all workspaces
- [ ] `bun run lint` passes with zero errors
- [ ] `bun run build` completes for all packages
- [ ] Shared types are importable from both backend and frontend
- [ ] Eden Treaty client compiles without type errors

### Must Have
- Bun workspaces with `workspace:*` references
- Turborepo task orchestration
- Biome linter/formatter (NOT ESLint/Prettier)
- TypeScript strict mode with project references
- ElysiaJS with plugin architecture (auth, CORS, swagger)
- better-auth integration for **DB-session-based auth** (NO JWT):
  - Sessions stored in `session` table in the database (managed by better-auth)
  - Secure, HTTP-only cookie (`__session`) for session token delivery
  - **Strict 30-minute sliding expiration (idle timeout)**: every authenticated request resets the 30-minute timer; if the user is idle for 30 minutes, the session is destroyed in the DB and the cookie is cleared
  - better-auth handles session creation, validation, renewal, and destruction
- Drizzle ORM with ALL 30 tables converted from `database/schema.postgres.sql`
- TanStack Router file-based routing with Vite plugin
- Shadcn UI initialized with `components.json` + Tailwind CSS v4
- react-hook-form + `@hookform/resolvers/zod` for form handling
- `date-fns` with `vi` locale for Vietnamese date formatting
- Zustand store skeleton with slices pattern
- Eden Treaty type-safe API client wired to backend types
- `.env.example` with DATABASE_URL, BETTER_AUTH_SECRET, PORT variables
- Pinned dependency versions in all package.json files

### Must NOT Have (Guardrails)
- ❌ No business logic in route handlers (placeholder responses only)
- ❌ No database migration execution (config files yes, `drizzle-kit push` no)
- ❌ No Ant Design (pure Shadcn UI + Tailwind CSS v4)
- ❌ No `tailwind.config.js` (Tailwind v4 uses CSS-only config)
- ❌ No Docker/docker-compose files
- ❌ No CI/CD pipelines
- ❌ No test framework setup or test files
- ❌ No README.md per subdirectory (root README only)
- ❌ No JSDoc on empty skeleton files
- ❌ No utility functions that aren't needed yet (`formatDate`, `capitalize`, etc.)
- ❌ No error handling middleware beyond basic structure
- ❌ No custom hooks in shared package (premature abstraction)
- ❌ No seed data scripts or fixtures
- ❌ No logging infrastructure beyond console.log
- ❌ No multiple theme variants
- ❌ No i18n system (just Vietnamese locale on date-fns + Shadcn components)
- ❌ No WebSocket setup
- ❌ No file upload handling
- ❌ No API rate limiting
- ❌ No more than 2-3 example routes per app
- ❌ No actual password hashing logic (structure only — better-auth handles this internally)
- ❌ No JWT tokens — sessions are DB-stored and delivered via HTTP-only cookies only

---

## Target Folder Structure

```
code/
├── package.json                    # Root workspace config
├── bun.lock                        # Generated by bun install
├── turbo.json                      # Turborepo task config
├── biome.json                      # Biome linter/formatter config
├── tsconfig.json                   # Base TypeScript config
├── .env.example                    # Environment variable template
├── .gitignore                      # Git ignore rules
├── .vscode/
│   └── settings.json               # Biome formatter, editor settings
├── database/
│   ├── schema.md                   # (existing — DO NOT TOUCH)
│   └── schema.postgres.sql         # (existing — DO NOT TOUCH)
├── apps/
│   ├── backend/
│   │   ├── package.json
│   │   ├── tsconfig.json
│   │   ├── drizzle.config.ts       # Drizzle Kit configuration
│   │   └── src/
│   │       ├── index.ts            # ElysiaJS app entry point
│   │       ├── db/
│   │       │   ├── index.ts        # Database connection (drizzle + postgres-js)
│   │       │   └── schema/
│   │       │       ├── index.ts    # Barrel export of all schemas
│   │       │       ├── files.ts    # files table
│   │       │       ├── campuses.ts # campuses table
│   │       │       ├── organization.ts  # org_units, org_unit_status_events
│   │       │       ├── salary.ts   # salary_coefficients, allowance_types
│   │       │       ├── employees.ts     # employees + all sub-entity tables (11 tables)
│   │       │       ├── contracts.ts     # contract_types, employment_contracts, contract_appendices
│   │       │       ├── evaluations.ts   # employee_evaluations
│   │       │       ├── training.ts      # training_course_types, training_courses, training_registrations, training_results
│   │       │       ├── auth.ts     # auth_users, auth_roles, auth_user_roles, auth_sessions
│   │       │       └── audit.ts    # audit_logs
│   │       ├── plugins/
│   │       │   ├── auth.ts         # better-auth session plugin (DB sessions + HTTP-only cookie + 30-min sliding expiry)
│   │       │   └── db.ts           # Database plugin (inject db into context)
│   │       └── routes/
│   │           ├── index.ts        # Route barrel / health check
│   │           └── auth.ts         # Auth route example (login placeholder)
│   └── frontend/
│       ├── package.json
│       ├── tsconfig.json
│       ├── tsconfig.app.json
│       ├── tsconfig.node.json
│       ├── vite.config.ts
│       ├── index.html
│       ├── components.json         # Shadcn UI config (generated by shadcn init)
│       └── src/
│           ├── main.tsx            # App entry, providers, router
│           ├── app.css             # Global CSS (Tailwind v4 imports + @theme inline)
│           ├── lib/
│           │   └── utils.ts        # cn() utility (clsx + tailwind-merge)
│           ├── api/
│           │   └── client.ts       # Eden Treaty client setup
│           ├── stores/
│           │   ├── index.ts        # Store barrel
│           │   └── auth.ts         # Auth store (Zustand slice)
│           ├── components/
│           │   └── ui/             # Shadcn UI components (added via shadcn add)
│           │       └── .gitkeep    # Placeholder (components added in later tasks)
│           ├── routes/
│           │   ├── __root.tsx      # Root layout (Shadcn ThemeProvider, base styles)
│           │   ├── index.tsx       # Home/dashboard route
│           │   └── login.tsx       # Login page route
│           └── routeTree.gen.ts    # Auto-generated by TanStack Router
├── packages/
│   └── shared/
│       ├── package.json
│       ├── tsconfig.json
│       └── src/
│           ├── index.ts            # Main barrel export
│           ├── types/
│           │   ├── index.ts        # Types barrel
│           │   ├── auth.ts         # Auth-related types (User, Role, LoginRequest/Response)
│           │   └── common.ts       # Common types (ApiResponse, PaginatedResponse)
│           └── validators/
│               ├── index.ts        # Validators barrel
│               └── auth.ts         # Auth validators (loginSchema, etc.)
```

---

## Verification Strategy (MANDATORY)

> **UNIVERSAL RULE: ZERO HUMAN INTERVENTION**
>
> ALL tasks in this plan MUST be verifiable WITHOUT any human action.
> This is NOT conditional — it applies to EVERY task, regardless of test strategy.

### Test Decision
- **Infrastructure exists**: NO
- **Automated tests**: None (out of scope for scaffold)
- **Framework**: N/A

### Agent-Executed QA Scenarios (MANDATORY — ALL tasks)

Every task includes agent-executed QA scenarios as the PRIMARY verification method.
The executing agent will directly run the deliverable and verify it using Bash commands.

**Verification Tool by Deliverable Type:**

| Type | Tool | How Agent Verifies |
|------|------|-------------------|
| Config files | Bash | `bun install`, `bun run lint`, `bun run type-check` |
| Backend skeleton | Bash | `bun run --filter @hrms/backend dev` → check server starts |
| Frontend skeleton | Playwright | Navigate to localhost:5173, verify page renders |
| Shared package | Bash | TypeScript compilation verifies imports work |
| Integration | Bash + Playwright | Full `bun run dev`, verify both servers, cross-package imports |

---

## Execution Strategy

### Parallel Execution Waves

```
Wave 1 (Start Immediately):
└── Task 1: Root monorepo infrastructure [no dependencies]

Wave 2 (After Wave 1):
├── Task 2: Shared package [depends: 1]
├── Task 3: Backend skeleton + FULL Drizzle schema [depends: 1]
└── Task 4: Frontend skeleton + Shadcn UI [depends: 1]

Wave 3 (After Wave 2):
└── Task 5: Integration & verification [depends: 2, 3, 4]

Critical Path: Task 1 → Task 3 (largest) → Task 5
Parallel Speedup: ~35% faster than sequential (Wave 2 runs 3 tasks in parallel)
```

### Dependency Matrix

| Task | Depends On | Blocks | Can Parallelize With |
|------|------------|--------|---------------------|
| 1 | None | 2, 3, 4 | None (must be first) |
| 2 | 1 | 5 | 3, 4 |
| 3 | 1 | 5 | 2, 4 |
| 4 | 1 | 5 | 2, 3 |
| 5 | 2, 3, 4 | None | None (final) |

---

## TODOs

- [ ] 1. Root Monorepo Infrastructure

  **What to do**:
  - Create root `package.json` with Bun workspace config:
    ```json
    {
      "name": "hrms",
      "private": true,
      "workspaces": ["apps/*", "packages/*"],
      "scripts": {
        "dev": "turbo dev",
        "build": "turbo build",
        "lint": "biome check .",
        "lint:fix": "biome check --write .",
        "format": "biome format --write .",
        "type-check": "turbo type-check",
        "clean": "turbo clean"
      },
      "devDependencies": {
        "@biomejs/biome": "1.9.4",
        "turbo": "2.3.3",
        "typescript": "5.7.2"
      }
    }
    ```
  - Create `turbo.json`:
    ```json
    {
      "$schema": "https://turbo.build/schema.json",
      "tasks": {
        "build": {
          "dependsOn": ["^build"],
          "outputs": ["dist/**"]
        },
        "dev": {
          "cache": false,
          "persistent": true
        },
        "lint": {},
        "type-check": {
          "dependsOn": ["^build"]
        },
        "clean": {
          "cache": false
        }
      }
    }
    ```
  - Create `biome.json` with TypeScript/React rules, monorepo-aware config:
    - Formatter: 2 spaces, single quotes, trailing commas, semicolons
    - Linter: recommended rules enabled
    - Files: include `apps/**`, `packages/**`
    - VCS: git integration enabled
  - Create base `tsconfig.json`:
    - `target: "ES2022"`, `module: "ESNext"`, `moduleResolution: "bundler"`
    - `strict: true`, `noUncheckedIndexedAccess: true`
    - `skipLibCheck: true`, `resolveJsonModule: true`
  - Create `.env.example`:
    ```
    # Database
    DATABASE_URL=postgresql://user:password@localhost:5432/hrms

    # Auth (better-auth)
    BETTER_AUTH_SECRET=your-secret-key-here-min-32-chars
    BETTER_AUTH_URL=http://localhost:3000

    # Server
    BACKEND_PORT=3000
    FRONTEND_PORT=5173

    # Environment
    NODE_ENV=development
    ```
  - Update `.gitignore` to include: `node_modules/`, `dist/`, `.turbo/`, `.env`
    - Note: Do NOT ignore `*.gen.ts` globally — `routeTree.gen.ts` is auto-generated by TanStack Router and should be committed so that `tsc --noEmit` works in CI without running the dev server. The TanStack Router Vite plugin generates it on first `dev` run.
  - Create `.vscode/settings.json`:
    - Default formatter: `biomejs.biome`
    - Format on save: true
    - Biome organize imports on save

  **Must NOT do**:
  - Do not run `bun install` yet (packages don't exist)
  - Do not create README.md files
  - Do not add ESLint or Prettier configs
  - Do not add `tailwind.config.js` (Tailwind v4 uses CSS-only config)

  **Recommended Agent Profile**:
  - **Category**: `quick`
    - Reason: Creating config files from well-defined templates, no complex logic
  - **Skills**: `[]`
    - No special skills needed for config file creation
  - **Skills Evaluated but Omitted**:
    - `frontend-ui-ux`: Not relevant — no UI work in this task

  **Parallelization**:
  - **Can Run In Parallel**: NO
  - **Parallel Group**: Wave 1 (solo)
  - **Blocks**: Tasks 2, 3, 4
  - **Blocked By**: None

  **References**:

  **Pattern References**:
  - `database/schema.postgres.sql` — Existing file that must remain in place at `database/` (do NOT move)

  **External References**:
  - Turborepo config: https://turbo.build/repo/docs — `tasks` field with `dependsOn`, `outputs`, `persistent`
  - Biome config: https://biomejs.dev/guides/getting-started — `biome.json` schema for monorepo
  - Bun workspaces: https://bun.sh/docs/pm/workspaces — `workspaces` field in package.json

  **WHY Each Reference Matters**:
  - `database/schema.postgres.sql` — Must be preserved in the monorepo. The scaffold builds around this existing file.
  - Turborepo docs — Need exact `tasks` schema format for dependency-aware builds
  - Biome docs — Need correct `extends: "//"` pattern for monorepo sub-configs

  **Acceptance Criteria**:

  **Agent-Executed QA Scenarios (MANDATORY):**

  ```
  Scenario: Root config files exist with correct structure
    Tool: Bash
    Preconditions: None
    Steps:
      1. ls -la package.json turbo.json biome.json tsconfig.json .env.example .gitignore
      2. Assert: All 6 files exist (exit code 0)
      3. cat package.json | bun -e "const p=JSON.parse(await Bun.stdin.text()); console.log(p.workspaces)"
      4. Assert: Output contains ["apps/*", "packages/*"]
      5. cat turbo.json | bun -e "const p=JSON.parse(await Bun.stdin.text()); console.log(Object.keys(p.tasks))"
      6. Assert: Output contains build, dev, lint, type-check
      7. ls .vscode/settings.json
      8. Assert: File exists
    Expected Result: All root config files present with correct content
    Evidence: Command output captured

  Scenario: Existing database files are untouched
    Tool: Bash
    Preconditions: database/ directory exists
    Steps:
      1. ls database/schema.postgres.sql database/schema.md
      2. Assert: Both files exist
      3. wc -l database/schema.postgres.sql
      4. Assert: 555 lines (unchanged)
    Expected Result: Database files preserved
    Evidence: wc output captured
  ```

  **Commit**: YES
  - Message: `chore(root): initialize monorepo infrastructure with Bun workspaces, Turborepo, and Biome`
  - Files: `package.json`, `turbo.json`, `biome.json`, `tsconfig.json`, `.env.example`, `.gitignore`, `.vscode/settings.json`

---

- [ ] 2. Shared Package (`packages/shared`)

  **What to do**:
  - Create `packages/shared/package.json`:
    ```json
    {
      "name": "@hrms/shared",
      "version": "0.0.1",
      "private": true,
      "type": "module",
      "exports": {
        ".": "./src/index.ts",
        "./types": "./src/types/index.ts",
        "./validators": "./src/validators/index.ts"
      }
    }
    ```
  - Create `packages/shared/tsconfig.json` extending root:
    - `extends: "../../tsconfig.json"`
    - `composite: true`, `declaration: true`, `declarationMap: true`
    - `rootDir: "./src"`, `outDir: "./dist"`
  - Create shared types in `src/types/`:
    - `auth.ts`: `User`, `Role`, `RoleCode`, `LoginRequest`, `LoginResponse`, `Session` types matching the database schema in `database/schema.postgres.sql` (lines 478–555)
    - `common.ts`: `ApiResponse<T>`, `PaginatedResponse<T>`, `ApiError` generic types
    - `index.ts`: barrel export
  - Create shared validators in `src/validators/`:
    - `auth.ts`: `loginSchema` (Zod schema for login request — username + password), `changePasswordSchema`
    - `index.ts`: barrel export
  - Create `src/index.ts`: re-export everything from types and validators
  - Install Zod as dependency: add `"zod": "3.24.1"` to package.json dependencies

  **Must NOT do**:
  - Do not create utility functions (no `formatDate`, `capitalize`, etc.)
  - Do not create custom hooks
  - Do not add more than 2-3 type files (this is a scaffold)
  - Do not add JSDoc comments to types
  - Do not create employee/contract/training types yet (those come with feature work)

  **Recommended Agent Profile**:
  - **Category**: `unspecified-low`
    - Reason: Straightforward type definition and schema creation
  - **Skills**: `[]`
    - No special skills needed
  - **Skills Evaluated but Omitted**:
    - `frontend-ui-ux`: Not relevant — no UI work

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 2 (with Tasks 3, 4)
  - **Blocks**: Task 5
  - **Blocked By**: Task 1

  **References**:

  **Pattern References**:
  - `database/schema.postgres.sql:478-536` — Auth tables (auth_users, auth_roles, auth_user_roles, auth_sessions) — use these column definitions to derive TypeScript types

  **API/Type References**:
  - `database/schema.postgres.sql:508-513` — `auth_roles` table: role_code constraint `IN ('ADMIN','TCCB','TCKT','EMPLOYEE')` — use as literal union type
  - `database/schema.postgres.sql:478-493` — `auth_users` table: columns define the `User` type shape
  - `database/schema.postgres.sql:524-536` — `auth_sessions` table: columns define the `AuthSession` type

  **External References**:
  - Zod v3 docs: https://zod.dev — Schema definition syntax (`z.object`, `z.string`, `z.enum`)
  - Bun workspaces exports: https://bun.sh/docs/pm/workspaces — `exports` field for package entry points

  **WHY Each Reference Matters**:
  - `schema.postgres.sql:478-536` — The TypeScript types MUST match the database columns exactly. The executor should read these SQL definitions and create corresponding TS interfaces.
  - Zod docs — Need correct v3 API for schema definitions
  - Bun exports — Need correct `exports` map syntax for the shared package to be importable

  **Acceptance Criteria**:

  **Agent-Executed QA Scenarios (MANDATORY):**

  ```
  Scenario: Shared package structure is correct
    Tool: Bash
    Preconditions: Task 1 completed
    Steps:
      1. ls packages/shared/package.json packages/shared/tsconfig.json
      2. Assert: Both files exist
      3. ls packages/shared/src/index.ts packages/shared/src/types/index.ts packages/shared/src/types/auth.ts packages/shared/src/types/common.ts packages/shared/src/validators/index.ts packages/shared/src/validators/auth.ts
      4. Assert: All 6 source files exist
      5. cat packages/shared/package.json | bun -e "const p=JSON.parse(await Bun.stdin.text()); console.log(p.name)"
      6. Assert: Output is "@hrms/shared"
    Expected Result: All shared package files present with correct naming
    Evidence: Command output captured

  Scenario: TypeScript types compile without errors
    Tool: Bash
    Preconditions: packages/shared/ created
    Steps:
      1. cd packages/shared && bunx tsc --noEmit
      2. Assert: Exit code 0, no type errors
    Expected Result: Shared package compiles cleanly
    Evidence: tsc output captured
  ```

  **Commit**: YES
  - Message: `feat(shared): add shared types and validators package with auth types and Zod schemas`
  - Files: `packages/shared/**`

---

- [ ] 3. Backend Skeleton + Full Drizzle Schema (`apps/backend`)

  **What to do**:
  - Create `apps/backend/package.json`:
    ```json
    {
      "name": "@hrms/backend",
      "version": "0.0.1",
      "private": true,
      "type": "module",
      "exports": {
        ".": "./src/index.ts"
      },
      "scripts": {
        "dev": "bun --watch src/index.ts",
        "build": "bun build src/index.ts --outdir dist --target bun",
        "start": "bun dist/index.js",
        "type-check": "tsc --noEmit",
        "db:generate": "drizzle-kit generate",
        "db:migrate": "drizzle-kit migrate",
        "db:studio": "drizzle-kit studio"
      },
      "dependencies": {
        "@hrms/shared": "workspace:*",
        "@elysiajs/cors": "1.1.1",
        "@elysiajs/swagger": "1.1.6",
        "better-auth": "1.2.7",
        "drizzle-orm": "0.38.3",
        "elysia": "1.1.27",
        "postgres": "3.4.5"
      },
      "devDependencies": {
        "@types/bun": "latest",
        "drizzle-kit": "0.30.2"
      }
    }
    ```
    Note: Use `postgres` (postgres.js) driver, not `pg` (node-postgres) — better Bun compatibility.
  - Create `apps/backend/tsconfig.json` extending root:
    - `extends: "../../tsconfig.json"`
    - `rootDir: "./src"`, `outDir: "./dist"`
    - `paths: { "@/*": ["./src/*"] }`
    - `references: [{ "path": "../../packages/shared" }]`
  - Create `apps/backend/drizzle.config.ts`:
    - Schema path: `./src/db/schema`
    - Output: `./drizzle` (migrations folder)
    - Driver: `postgres-js`
    - Connection from `DATABASE_URL` env var
  - Create `apps/backend/src/index.ts` — ElysiaJS app entry:
    - Create Elysia instance
    - `.use(cors())` — CORS plugin
    - `.use(swagger())` — Swagger docs at `/swagger`
    - `.use(dbPlugin)` — Database connection plugin
    - `.use(authRoutes)` — Auth routes
    - `.use(healthRoute)` — Health check at `/api/health`
    - `.listen(process.env.BACKEND_PORT || 3000)`
    - Export `type App = typeof app` for Eden Treaty
  - Create `apps/backend/src/db/index.ts` — Database connection:
    - Import `postgres` from postgres.js
    - Import `drizzle` from drizzle-orm/postgres-js
    - Create connection using `DATABASE_URL` env var
    - Export `db` instance

  **FULL DRIZZLE SCHEMA CONVERSION (ALL 30 TABLES)**:

  Convert EVERY table from `database/schema.postgres.sql` to Drizzle TypeScript definitions. Organize by domain into files under `apps/backend/src/db/schema/`:

  - **`files.ts`** — `files` table (lines 10-19):
    - `id`, `storage_path`, `original_name`, `mime_type`, `byte_size`, `sha256`, `uploaded_by_user_id`, `uploaded_at`
    - Note: `uploaded_by_user_id` foreign key to `auth_users` is added via ALTER TABLE (lines 495-506) — use Drizzle `references()` directly

  - **`campuses.ts`** — `campuses` table (lines 24-32):
    - `id`, `campus_code` (unique), `campus_name`, `address`, `phone`, `email`, `created_at`

  - **`organization.ts`** — 2 tables:
    - `org_units` (lines 37-63): Self-referencing `parent_id`, foreign key to `campuses`, `unit_type` CHECK constraint with enum `('HOI_DONG','BAN','KHOA','PHONG','BO_MON','PHONG_THI_NGHIEM','TRUNG_TAM')`, `status` CHECK with enum `('active','merged','dissolved')`
    - `org_unit_status_events` (lines 69-94): Foreign keys to `org_units` and `files`, `event_type` CHECK `('DISSOLVE','MERGE')`, `reason` CHECK `('GIAI_THE','SAP_NHAP','TAI_CO_CAU','KHAC')`, conditional CHECK constraint on `merged_into_org_unit_id`

  - **`salary.ts`** — 2 tables:
    - `salary_coefficients` (lines 101-117): `grade_code`, `step_no`, `coefficient` (numeric), status CHECK, unique constraint on `(grade_code, step_no)`
    - `allowance_types` (lines 122-133): `allowance_name` (unique), `calc_method`, status CHECK

  - **`employees.ts`** — 11 tables (the largest schema file):
    - `employees` (lines 140-176): Core table with foreign keys to `org_units`, `salary_coefficients`, `files`; gender CHECK `('NAM','NU','KHAC')`, work_status CHECK `('pending','working','terminated')`, contract_status CHECK `('none','valid','expired','renewal_wait')`
    - `employee_terminations` (lines 184-191)
    - `employee_assignments` (lines 194-208): With date order CHECK constraint
    - `employee_family_members` (lines 213-225): relation CHECK `('CHA','ME','VO_CHONG','CON','NGUOI_PHU_THUOC','KHAC')`
    - `employee_bank_accounts` (lines 227-235): Unique constraint on `(employee_id, account_no)`
    - `employee_previous_jobs` (lines 237-246)
    - `employee_party_memberships` (lines 248-256): `organization_type` CHECK `('DOAN','DANG')`
    - `employee_degrees` (lines 258-269): graduation_year CHECK `>= 1900`
    - `employee_certifications` (lines 271-281)
    - `employee_foreign_work_permits` (lines 283-298)
    - `employee_allowances` (lines 303-313): Foreign keys to `employees` and `allowance_types`, composite unique on `(employee_id, allowance_type_id)`, effective dates

  - **`contracts.ts`** — 3 tables:
    - `contract_types` (lines 318-332): Months/renewals CHECK constraints
    - `employment_contracts` (lines 335-358): Foreign keys to employees, contract_types, org_units, files; status CHECK `('draft','valid','expired','terminated')`
    - `contract_appendices` (lines 365-373)

  - **`evaluations.ts`** — 1 table:
    - `employee_evaluations` (lines 378-402): `eval_type` CHECK `('REWARD','DISCIPLINE')`, reward_amount CHECK

  - **`training.ts`** — 4 tables:
    - `training_course_types` (lines 409-415)
    - `training_courses` (lines 417-446): Multiple CHECK constraints (dates, cost, registration_limit), status CHECK `('draft','open_registration','in_progress','completed','closed')`
    - `training_registrations` (lines 450-460): Unique `(course_id, employee_id)`, participation_status CHECK
    - `training_results` (lines 464-473): Unique `registration_id`, result_status CHECK `('completed','failed')`

  - **`auth.ts`** — 6 tables (4 custom + 2 better-auth managed):
    - `auth_users` (lines 478-493): Foreign key to `employees`, status CHECK `('active','locked')`
    - `auth_roles` (lines 508-513): `role_code` CHECK `('ADMIN','TCCB','TCKT','EMPLOYEE')`
    - `auth_user_roles` (lines 516-522): Composite primary key `(user_id, role_id)`
    - `session` (better-auth managed): DB-stored sessions with `expiresAt` for 30-min sliding expiration, `ipAddress`, `userAgent`, `token` (unique). better-auth reads/writes this table directly.
    - `account` (better-auth managed): Linked auth provider accounts (credential, OAuth, etc.). Required by better-auth.
    - `verification` (better-auth managed): Email/phone verification tokens. Required by better-auth.
    - NOTE: The old `auth_sessions` table is **removed** — replaced entirely by better-auth's `session` table

  - **`audit.ts`** — 1 table:
    - `audit_logs` (lines 543-554): `metadata` (jsonb), foreign key to `auth_users`

  - **`schema/index.ts`** — Barrel export re-exporting ALL tables and their inferred types from all schema files

  **For each table, the executor MUST**:
  - Use `pgTable()` from `drizzle-orm/pg-core`
  - Map every column with correct Drizzle type (`uuid`, `varchar`, `text`, `integer`, `numeric`, `boolean`, `timestamp`, `date`, `bigint`, `jsonb`, `inet`)
  - Add `.primaryKey()`, `.notNull()`, `.default()`, `.unique()` as per SQL
  - Add `references(() => otherTable.id)` for foreign keys with correct `onDelete` action
  - Use `pgEnum()` for CHECK constraints that define fixed value sets (e.g., gender, status enums)
  - Export inferred types: `export type Employee = typeof employees.$inferSelect;` and `export type NewEmployee = typeof employees.$inferInsert;`
  - Use `casing: 'snake_case'` in drizzle config to auto-map TypeScript camelCase ↔ SQL snake_case
  - PostgreSQL `inet` type → use `text()` in Drizzle (no native inet type)
  - PostgreSQL `char(64)` → use `char({ length: 64 })`
  - PostgreSQL `numeric(8,3)` → use `numeric({ precision: 8, scale: 3 })`
  - PostgreSQL `bigint` → use `bigint({ mode: 'number' })` or `bigint({ mode: 'bigint' })`

  **Plugins and Routes**:
  - Create `apps/backend/src/plugins/db.ts` — Database plugin:
    - Elysia plugin that decorates context with `db` instance
    - Uses `{ name: 'db' }` for deduplication
  - Create `apps/backend/src/plugins/auth.ts` — better-auth session plugin:
    - Initialize `better-auth` with:
      - `database`: Drizzle adapter pointing to the app's `db` instance (uses the `session`, `user`, `account`, and `verification` tables managed by better-auth)
      - `session.expiresIn`: `1800` (30 minutes in seconds)
      - `session.updateAge`: `0` (update `expiresAt` on EVERY request — this is what makes the 30-minute window a true sliding/idle timeout)
      - `session.cookieCache.enabled`: `false` (always validate against the DB — no stale cookie cache)
      - `advanced.cookiePrefix`: `__session` (secure, HTTP-only cookie name)
    - Export an Elysia plugin that:
      - Registers a catch-all handler (`/api/auth/*`) that forwards requests to `better-auth`'s request handler
      - Provides a `derive` middleware that reads the session cookie, validates it against the DB, and injects `{ user, session }` into the Elysia context (or `null` if no valid session)
      - Uses guard pattern for protected routes (returns 401 if no valid session)
    - Skeleton only — better-auth handles password hashing, session token generation, and DB operations internally
    - **Session lifecycle**:
      1. **Login**: `POST /api/auth/sign-in/email` → better-auth verifies credentials, creates a row in `session` table with `expiresAt = now() + 30 min`, sets HTTP-only cookie
      2. **Each request**: Middleware reads cookie → looks up session in DB → if `expiresAt < now()`, destroy session & return 401 → otherwise, update `expiresAt = now() + 30 min` (sliding window)
      3. **Logout**: `POST /api/auth/sign-out` → better-auth deletes the session row from DB and clears the cookie
      4. **Idle timeout**: If 30 minutes pass with no request, the session row is expired; next request with that cookie gets 401 and the row is cleaned up
  - Create `apps/backend/src/routes/index.ts` — Health check route:
    - `GET /api/health` → `{ status: 'ok', timestamp: new Date().toISOString() }`
  - Create `apps/backend/src/routes/auth.ts` — Auth route example:
    - All auth endpoints are handled by better-auth via the catch-all `/api/auth/*` route in the auth plugin:
      - `POST /api/auth/sign-in/email` — Login (email/username + password)
      - `POST /api/auth/sign-up/email` — Registration (if enabled)
      - `POST /api/auth/sign-out` — Logout (destroys DB session, clears cookie)
      - `GET /api/auth/session` — Get current session (validates against DB)
    - The route file simply mounts the better-auth plugin and adds any app-specific auth routes (e.g., `GET /api/auth/me` that returns the current user with roles from our custom `auth_user_roles` table)
    - Uses `@hrms/shared/validators` loginSchema for any custom endpoint request validation

  **Must NOT do**:
  - Do not implement custom password hashing (better-auth handles this internally)
  - Do not implement custom session management (better-auth handles session creation, validation, renewal via DB)
  - Do not run migrations or connect to a real database
  - Do not add error handling middleware beyond basic structure
  - Do not add logging infrastructure
  - Do not add rate limiting
  - Do not create more than 2 route files (health + auth)
  - Do not add seed data scripts
  - Do not add Drizzle relations (just tables and foreign keys for now)

  **Recommended Agent Profile**:
  - **Category**: `unspecified-high`
    - Reason: Converting 30 SQL tables to Drizzle TypeScript is substantial work (~600+ lines of schema code). Requires careful reading of SQL DDL and precise type mapping.
  - **Skills**: `[]`
    - No special skills needed, but agent must be thorough with SQL-to-Drizzle mapping
  - **Skills Evaluated but Omitted**:
    - `playwright`: Not needed — backend verification is via Bash

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 2 (with Tasks 2, 4)
  - **Blocks**: Task 5
  - **Blocked By**: Task 1

  **References**:

  **Pattern References**:
  - `database/schema.postgres.sql:10-19` — `files` table definition
  - `database/schema.postgres.sql:24-32` — `campuses` table definition
  - `database/schema.postgres.sql:37-63` — `org_units` table definition (self-referencing, CHECK constraints)
  - `database/schema.postgres.sql:69-94` — `org_unit_status_events` (conditional CHECK constraint)
  - `database/schema.postgres.sql:101-117` — `salary_coefficients` (numeric type, composite unique)
  - `database/schema.postgres.sql:122-133` — `allowance_types`
  - `database/schema.postgres.sql:138-176` — `employees` (sequence default, multiple FKs, CHECK constraints)
  - `database/schema.postgres.sql:184-191` — `employee_terminations`
  - `database/schema.postgres.sql:194-208` — `employee_assignments` (date order CHECK)
  - `database/schema.postgres.sql:213-225` — `employee_family_members` (relation enum)
  - `database/schema.postgres.sql:227-235` — `employee_bank_accounts` (composite unique)
  - `database/schema.postgres.sql:237-246` — `employee_previous_jobs`
  - `database/schema.postgres.sql:248-256` — `employee_party_memberships` (org type enum)
  - `database/schema.postgres.sql:258-269` — `employee_degrees` (year CHECK)
  - `database/schema.postgres.sql:271-281` — `employee_certifications` (date order CHECK)
  - `database/schema.postgres.sql:283-298` — `employee_foreign_work_permits`
  - `database/schema.postgres.sql:303-313` — `employee_allowances` (composite unique)
  - `database/schema.postgres.sql:318-332` — `contract_types` (months/renewals CHECKs)
  - `database/schema.postgres.sql:335-358` — `employment_contracts` (multiple FKs, status CHECK)
  - `database/schema.postgres.sql:365-373` — `contract_appendices`
  - `database/schema.postgres.sql:378-402` — `employee_evaluations` (eval_type CHECK)
  - `database/schema.postgres.sql:409-415` — `training_course_types`
  - `database/schema.postgres.sql:417-446` — `training_courses` (multiple CHECK constraints)
  - `database/schema.postgres.sql:450-460` — `training_registrations` (composite unique)
  - `database/schema.postgres.sql:464-473` — `training_results` (unique FK)
  - `database/schema.postgres.sql:478-493` — `auth_users` (FK to employees)
  - `database/schema.postgres.sql:508-513` — `auth_roles` (role_code enum)
  - `database/schema.postgres.sql:516-522` — `auth_user_roles` (composite PK)
  - `database/schema.postgres.sql:524-536` — `auth_sessions` (inet, expires CHECK)
  - `database/schema.postgres.sql:543-554` — `audit_logs` (jsonb metadata)

  **External References**:
  - ElysiaJS plugin system: https://elysiajs.com/essential/plugin.html — Plugin architecture with `name`, `as('scoped')`, guard patterns
  - better-auth docs: https://www.better-auth.com/docs — Session-based auth with DB storage, Drizzle adapter, cookie config
  - ElysiaJS Eden Treaty: https://elysiajs.com/eden/treaty/overview.html — Export `type App` pattern
  - Drizzle ORM PostgreSQL: https://orm.drizzle.team/docs/get-started-postgresql — postgres-js driver setup
  - Drizzle schema declaration: https://orm.drizzle.team/docs/sql-schema-declaration — `pgTable`, column types, `pgEnum`
  - Drizzle column types: https://orm.drizzle.team/docs/column-types/pg — All PostgreSQL column type mappings

  **WHY Each Reference Matters**:
  - `database/schema.postgres.sql` (ALL lines) — **Critical**: Every single table must be faithfully converted. The executor reads the SQL DDL and creates Drizzle `pgTable` calls preserving all columns, types, constraints, and foreign keys.
  - ElysiaJS plugin docs — Need correct plugin architecture pattern (named plugins, scoped lifecycle, guard)
  - better-auth docs — Need correct session config (`expiresIn`, `updateAge: 0` for sliding window), Drizzle adapter setup, and Elysia integration pattern
  - Eden Treaty docs — Need correct `type App = typeof app` export pattern for frontend consumption
  - Drizzle docs — Need correct postgres-js driver setup and ALL column type mappings (uuid, varchar, numeric, bigint, jsonb, inet→text, etc.)

  **Acceptance Criteria**:

  **Agent-Executed QA Scenarios (MANDATORY):**

  ```
  Scenario: All 10 schema files exist with correct structure
    Tool: Bash
    Preconditions: Task 1 completed
    Steps:
      1. ls apps/backend/src/db/schema/index.ts apps/backend/src/db/schema/files.ts apps/backend/src/db/schema/campuses.ts apps/backend/src/db/schema/organization.ts apps/backend/src/db/schema/salary.ts apps/backend/src/db/schema/employees.ts apps/backend/src/db/schema/contracts.ts apps/backend/src/db/schema/evaluations.ts apps/backend/src/db/schema/training.ts apps/backend/src/db/schema/auth.ts apps/backend/src/db/schema/audit.ts
      2. Assert: All 11 files exist (10 domain files + 1 barrel index)
      3. grep -c "pgTable" apps/backend/src/db/schema/*.ts | grep -v "index.ts"
      4. Assert: Total pgTable definitions across all files = 30 (one per table in database/schema.postgres.sql)
    Expected Result: All schema files exist with pgTable definitions
    Evidence: File listing + grep count captured

  Scenario: Backend TypeScript compiles without errors
    Tool: Bash
    Preconditions: packages/shared created (Task 2), bun install run
    Steps:
      1. cd apps/backend && bunx tsc --noEmit
      2. Assert: Exit code 0
    Expected Result: No type errors in backend code (including all 30 Drizzle table definitions)
    Evidence: tsc output captured

  Scenario: Backend starts and responds to health check
    Tool: Bash
    Preconditions: Task 1 completed, bun install run from root
    Steps:
      1. cd apps/backend && bun run dev &
      2. sleep 3
      3. curl -s http://localhost:3000/api/health
      4. Assert: Response contains {"status":"ok"}
      5. Assert: Response contains "timestamp" field
      6. kill %1 (stop dev server)
    Expected Result: Backend starts and serves health endpoint
    Evidence: curl response captured

  Scenario: Swagger docs are accessible
    Tool: Bash
    Preconditions: Backend dev server running
    Steps:
      1. curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/swagger
      2. Assert: HTTP status is 200
    Expected Result: Swagger UI is served
    Evidence: HTTP status code captured

  Scenario: Auth routes exist via better-auth
    Tool: Bash
    Preconditions: Backend dev server running
    Steps:
      1. curl -s -X GET http://localhost:3000/api/auth/session
      2. Assert: Response returns JSON (empty session or 401 — not a 404)
      3. curl -s -X POST http://localhost:3000/api/auth/sign-in/email -H "Content-Type: application/json" -d '{"email":"test@test.com","password":"test"}'
      4. Assert: Response returns JSON error (invalid credentials) — not 404
      5. Assert: better-auth endpoints are mounted and reachable
    Expected Result: better-auth routes are accessible
    Evidence: curl response captured

  Scenario: Drizzle config is valid
    Tool: Bash
    Preconditions: Backend package created
    Steps:
      1. cat apps/backend/drizzle.config.ts
      2. Assert: File contains "schema" pointing to "./src/db/schema"
      3. Assert: File contains "dialect" or "driver" referencing "pg" or "postgresql"
      4. Assert: File references DATABASE_URL env var
    Expected Result: Drizzle config is correctly structured
    Evidence: File contents captured
  ```

  **Commit**: YES
  - Message: `feat(backend): scaffold ElysiaJS app with full Drizzle ORM schema (30 tables), better-auth DB session auth, and example routes`
  - Files: `apps/backend/**`

---

- [ ] 4. Frontend Skeleton + Shadcn UI (`apps/frontend`)

  **What to do**:
  - Create `apps/frontend/package.json`:
    ```json
    {
      "name": "@hrms/frontend",
      "version": "0.0.1",
      "private": true,
      "type": "module",
      "scripts": {
        "dev": "vite",
        "build": "tsc -b && vite build",
        "preview": "vite preview",
        "type-check": "tsc --noEmit"
      },
      "dependencies": {
        "@hrms/shared": "workspace:*",
        "@hrms/backend": "workspace:*",
        "@elysiajs/eden": "1.1.3",
        "@hookform/resolvers": "3.9.1",
        "@radix-ui/react-slot": "1.1.1",
        "@tanstack/react-query": "5.62.16",
        "@tanstack/react-router": "1.93.0",
        "class-variance-authority": "0.7.1",
        "clsx": "2.1.1",
        "date-fns": "4.1.0",
        "lucide-react": "0.468.0",
        "react": "18.3.1",
        "react-dom": "18.3.1",
        "react-hook-form": "7.54.2",
        "tailwind-merge": "2.6.0",
        "zustand": "5.0.2"
      },
      "devDependencies": {
        "@tailwindcss/vite": "4.0.0",
        "@tanstack/router-plugin": "1.93.0",
        "@types/react": "18.3.12",
        "@types/react-dom": "18.3.1",
        "@vitejs/plugin-react": "4.3.4",
        "tailwindcss": "4.0.0",
        "vite": "6.0.5"
      }
    }
    ```
    Note: React 18 (not 19) for maximum compatibility. Shadcn UI dependencies: `class-variance-authority`, `clsx`, `tailwind-merge`, `lucide-react` (icon library), `@radix-ui/react-slot`.
  - Create `apps/frontend/tsconfig.json`, `tsconfig.app.json`, `tsconfig.node.json`:
    - Base extends root tsconfig
    - App config: JSX react-jsx, strict, paths `@/*` → `./src/*`
    - Node config: for vite.config.ts
  - Create `apps/frontend/vite.config.ts`:
    - TanStack Router plugin with `autoCodeSplitting: true`
    - React plugin
    - Tailwind CSS v4 plugin: `import tailwindcss from '@tailwindcss/vite'`
    - Proxy `/api` to backend `http://localhost:3000` for dev
  - Create `apps/frontend/index.html`:
    - Standard Vite HTML template
    - Title: "HRMS - Hệ thống Quản lý Nhân sự"
    - Vietnamese lang attribute: `<html lang="vi">`
  - Create `apps/frontend/components.json` — Shadcn UI config:
    ```json
    {
      "$schema": "https://ui.shadcn.com/schema.json",
      "style": "new-york",
      "rsc": false,
      "tsx": true,
      "tailwind": {
        "config": "",
        "css": "src/app.css",
        "baseColor": "neutral",
        "cssVariables": true
      },
      "aliases": {
        "components": "@/components",
        "utils": "@/lib/utils",
        "ui": "@/components/ui",
        "lib": "@/lib",
        "hooks": "@/hooks"
      },
      "iconLibrary": "lucide"
    }
    ```
  - Create `apps/frontend/src/app.css` — Global Tailwind CSS v4 styles:
    ```css
    @import "tailwindcss";

    @theme inline {
      --color-background: oklch(1 0 0);
      --color-foreground: oklch(0.145 0 0);
      --color-card: oklch(1 0 0);
      --color-card-foreground: oklch(0.145 0 0);
      --color-popover: oklch(1 0 0);
      --color-popover-foreground: oklch(0.145 0 0);
      --color-primary: oklch(0.205 0 0);
      --color-primary-foreground: oklch(0.985 0 0);
      --color-secondary: oklch(0.97 0 0);
      --color-secondary-foreground: oklch(0.205 0 0);
      --color-muted: oklch(0.97 0 0);
      --color-muted-foreground: oklch(0.556 0 0);
      --color-accent: oklch(0.97 0 0);
      --color-accent-foreground: oklch(0.205 0 0);
      --color-destructive: oklch(0.577 0.245 27.325);
      --color-destructive-foreground: oklch(0.577 0.245 27.325);
      --color-border: oklch(0.922 0 0);
      --color-input: oklch(0.922 0 0);
      --color-ring: oklch(0.708 0 0);
      --color-chart-1: oklch(0.646 0.222 41.116);
      --color-chart-2: oklch(0.6 0.118 184.704);
      --color-chart-3: oklch(0.398 0.07 227.392);
      --color-chart-4: oklch(0.828 0.189 84.429);
      --color-chart-5: oklch(0.769 0.188 70.08);
      --color-sidebar: oklch(0.985 0 0);
      --color-sidebar-foreground: oklch(0.145 0 0);
      --color-sidebar-primary: oklch(0.205 0 0);
      --color-sidebar-primary-foreground: oklch(0.985 0 0);
      --color-sidebar-accent: oklch(0.97 0 0);
      --color-sidebar-accent-foreground: oklch(0.205 0 0);
      --color-sidebar-border: oklch(0.922 0 0);
      --color-sidebar-ring: oklch(0.708 0 0);
      --radius-sm: 0.25rem;
      --radius-md: 0.375rem;
      --radius-lg: 0.5rem;
      --radius-xl: 0.75rem;
    }

    @layer base {
      * {
        @apply border-border;
      }
      body {
        @apply bg-background text-foreground;
      }
    }
    ```
    Note: These are the standard Shadcn UI "new-york" theme CSS variables for Tailwind v4. The executor should generate the exact values via `shadcn init` if available, or use the standard palette above.

  - Create `apps/frontend/src/lib/utils.ts` — cn() utility:
    ```typescript
    import { type ClassValue, clsx } from 'clsx';
    import { twMerge } from 'tailwind-merge';

    export function cn(...inputs: ClassValue[]) {
      return twMerge(clsx(inputs));
    }
    ```
    This is the standard Shadcn UI utility function for merging Tailwind classes.

  - Create `apps/frontend/src/main.tsx`:
    - Import `app.css`
    - Create TanStack Router with `createRouter({ routeTree })`
    - Wrap with `QueryClientProvider` (TanStack Query)
    - Register router type globally
    - Render `RouterProvider`
  - Create `apps/frontend/src/api/client.ts` — Eden Treaty client:
    - Import `treaty` from `@elysiajs/eden`
    - Import `type App` from `@hrms/backend` (resolves via workspace dependency + backend `exports` field pointing to `./src/index.ts`)
    - Export typed `api` client pointing to `/api` (proxied by Vite)
  - Create `apps/frontend/src/stores/auth.ts` — Zustand auth store:
    - `user: User | null`
    - `isAuthenticated: boolean` (derived)
    - `login(credentials)` — placeholder
    - `logout()` — clears user
    - Use `devtools` middleware
  - Create `apps/frontend/src/stores/index.ts` — barrel export
  - Create `apps/frontend/src/components/ui/.gitkeep` — Placeholder for Shadcn UI components:
    - Shadcn components are added via `bunx shadcn@latest add button` etc. during feature work
    - For the scaffold, just create the directory with `.gitkeep`
  - Create `apps/frontend/src/routes/__root.tsx` — Root layout:
    - Basic layout with `<Outlet />`
    - TanStack Router `createRootRoute`
    - Import `app.css` is done in `main.tsx`, so root just provides layout structure
    - Simple container wrapper with Tailwind classes
  - Create `apps/frontend/src/routes/index.tsx` — Home route:
    - Simple welcome page: "Hệ thống Quản lý Nhân sự — Trường Đại học Thủy Lợi"
    - Use basic Tailwind CSS classes for layout (no Shadcn components needed for scaffold)
    - `createFileRoute('/')` pattern
  - Create `apps/frontend/src/routes/login.tsx` — Login page:
    - Basic login form using HTML form elements styled with Tailwind CSS classes
    - Vietnamese labels: "Tên đăng nhập", "Mật khẩu", "Đăng nhập"
    - `onSubmit` handler that calls `console.log` (placeholder, no API call)
    - `createFileRoute('/login')` pattern
    - Note: Shadcn Form components (Button, Input, Card, etc.) will be added during feature work via `bunx shadcn@latest add`. The scaffold uses basic HTML + Tailwind.

  **Must NOT do**:
  - Do not add Ant Design or any other UI component library
  - Do not create more than 3 routes (root, index, login)
  - Do not implement actual login/auth flow
  - Do not create error boundary components
  - Do not create multiple layout variants
  - Do not add i18n library (just use Vietnamese text directly in components)
  - Do not create custom hooks
  - Do not add loading spinners or skeleton screens
  - Do not implement dark mode or theme switching
  - Do not add Shadcn UI components via `shadcn add` in the scaffold (just prepare the directory and config)
  - Do not create `tailwind.config.js` (Tailwind v4 uses CSS-only config)

  **Recommended Agent Profile**:
  - **Category**: `unspecified-high`
    - Reason: Tailwind CSS v4 + Shadcn UI setup is newer and requires careful configuration. Multiple config files and the CSS-only Tailwind v4 approach needs attention.
  - **Skills**: `[]`
    - No special skills needed for scaffold creation
  - **Skills Evaluated but Omitted**:
    - `frontend-ui-ux`: Not needed — minimal UI, just scaffold structure
    - `playwright`: Will be needed in Task 5, not this task
    - `frontend-design`: Not needed — using Shadcn defaults, no custom design work in scaffold

  **Parallelization**:
  - **Can Run In Parallel**: YES
  - **Parallel Group**: Wave 2 (with Tasks 2, 3)
  - **Blocks**: Task 5
  - **Blocked By**: Task 1

  **References**:

  **Pattern References**:
  - `database/schema.postgres.sql:508-513` — `auth_roles` role codes (`ADMIN`, `TCCB`, `TCKT`, `EMPLOYEE`) — referenced in auth store type

  **API/Type References**:
  - `packages/shared/src/types/auth.ts` (created in Task 2) — `User`, `LoginRequest` types for store and form
  - `packages/shared/src/validators/auth.ts` (created in Task 2) — `loginSchema` for form validation reference

  **External References**:
  - TanStack Router file-based routing: https://tanstack.com/router/latest/docs/framework/react/guide/file-based-routing — `createFileRoute`, `__root.tsx` pattern
  - TanStack Router Vite plugin: https://tanstack.com/router/latest/docs/framework/react/guide/file-based-routing#vite-plugin — Plugin config with `autoCodeSplitting`
  - Shadcn UI installation (Vite): https://ui.shadcn.com/docs/installation/vite — Manual installation steps for Vite + React
  - Shadcn UI components.json: https://ui.shadcn.com/docs/components-json — Config file schema
  - Shadcn UI Tailwind CSS v4: https://ui.shadcn.com/docs/installation — Tailwind v4 CSS-only config with `@theme inline`
  - Tailwind CSS v4 Vite plugin: https://tailwindcss.com/docs/installation/vite — `@tailwindcss/vite` plugin setup
  - Eden Treaty client: https://elysiajs.com/eden/treaty/overview.html — `treaty<App>()` pattern
  - Zustand slices: https://docs.pmnd.rs/zustand/guides/slices-pattern — Domain-based store organization
  - date-fns Vietnamese locale: https://date-fns.org/docs/Locale — `import { vi } from 'date-fns/locale'`

  **WHY Each Reference Matters**:
  - TanStack Router docs — Need exact file naming conventions (`__root.tsx`, `index.tsx`, `login.tsx`) and `createFileRoute` API
  - Shadcn UI install docs — Need correct `components.json` config, `cn()` utility, and CSS variable setup for Tailwind v4
  - Tailwind CSS v4 docs — Need correct `@tailwindcss/vite` plugin setup and `@import "tailwindcss"` + `@theme inline` syntax (no tailwind.config.js)
  - Eden Treaty — Need correct `treaty<App>()` generic usage to get type inference from backend
  - Zustand — Need slices pattern for scalable store architecture
  - date-fns locale — Will be used by Shadcn date components in future feature work

  **Acceptance Criteria**:

  **Agent-Executed QA Scenarios (MANDATORY):**

  ```
  Scenario: Frontend dev server starts and serves page
    Tool: Playwright (playwright skill)
    Preconditions: bun install run from root, no backend needed for this check
    Steps:
      1. Start frontend dev server: cd apps/frontend && bun run dev &
      2. Wait 5 seconds for Vite to start
      3. Navigate to: http://localhost:5173
      4. Wait for: page to load (timeout: 10s)
      5. Assert: Page title contains "HRMS" or "Quản lý Nhân sự"
      6. Assert: Page body contains Vietnamese text
      7. Screenshot: .sisyphus/evidence/task-4-frontend-home.png
      8. Navigate to: http://localhost:5173/login
      9. Wait for: form visible (timeout: 5s)
      10. Assert: Login form is rendered with input fields
      11. Screenshot: .sisyphus/evidence/task-4-frontend-login.png
    Expected Result: Frontend serves home and login pages with Vietnamese content
    Evidence: .sisyphus/evidence/task-4-frontend-home.png, .sisyphus/evidence/task-4-frontend-login.png

  Scenario: Frontend TypeScript compiles without errors
    Tool: Bash
    Preconditions: packages/shared created (Task 2), bun install run, dev server has been started at least once (TanStack Router Vite plugin generates routeTree.gen.ts on first dev run)
    Steps:
      1. cd apps/frontend && bunx tsc --noEmit
      2. Assert: Exit code 0
    Expected Result: No type errors in frontend code (including routeTree.gen.ts generated by TanStack Router)
    Evidence: tsc output captured

  Scenario: Tailwind CSS v4 is active (styles applied)
    Tool: Playwright (playwright skill)
    Preconditions: Frontend dev server running
    Steps:
      1. Navigate to: http://localhost:5173
      2. Wait for: body to render (timeout: 5s)
      3. Inspect: body element computed background-color
      4. Assert: Background color matches theme value (not browser default white — should have explicit bg-background class applied)
      5. Screenshot: .sisyphus/evidence/task-4-tailwind-active.png
    Expected Result: Tailwind CSS v4 styles are being applied via the @theme inline config
    Evidence: .sisyphus/evidence/task-4-tailwind-active.png

  Scenario: Shadcn UI config file is valid
    Tool: Bash
    Preconditions: Frontend package created
    Steps:
      1. cat apps/frontend/components.json
      2. Assert: File contains "$schema" from shadcn
      3. Assert: File contains "rsc": false (not a Next.js app)
      4. Assert: File contains aliases for "@/components", "@/lib/utils"
      5. cat apps/frontend/src/lib/utils.ts
      6. Assert: File exports cn() function
      7. Assert: File imports from "clsx" and "tailwind-merge"
    Expected Result: Shadcn UI infrastructure is ready for component addition
    Evidence: File contents captured

  Scenario: Vietnamese content is present in login form
    Tool: Playwright (playwright skill)
    Preconditions: Frontend dev server running
    Steps:
      1. Navigate to: http://localhost:5173/login
      2. Wait for: form to render (timeout: 5s)
      3. Assert: Page contains text "Tên đăng nhập" or "Đăng nhập" or "Mật khẩu"
      4. Screenshot: .sisyphus/evidence/task-4-vi-content.png
    Expected Result: Vietnamese labels rendered in login form
    Evidence: .sisyphus/evidence/task-4-vi-content.png
  ```

  **Commit**: YES
  - Message: `feat(frontend): scaffold React SPA with TanStack Router, Shadcn UI + Tailwind CSS v4, and Zustand store`
  - Files: `apps/frontend/**`

---

- [ ] 5. Integration Verification & Final Wiring

  **What to do**:
  - Run `bun install` from root — verify all workspace dependencies resolve
  - Run `bun run type-check` — verify TypeScript across all workspaces
  - Run `bun run lint` — verify Biome passes on all files
  - Run `bun run build` — verify all packages build
  - Run `bun run dev` — verify both servers start simultaneously
  - Verify cross-package imports:
    - Backend imports `@hrms/shared` types and validators
    - Frontend imports `@hrms/shared` types
    - Frontend Eden Treaty client resolves backend types
  - Fix any issues discovered during integration
  - If Eden Treaty type resolution has issues with workspace references, add explicit type path in frontend tsconfig
  - Ensure Vite proxy configuration works (frontend `/api/*` → backend `localhost:3000`)
  - Verify `bun run dev` starts both backend (3000) and frontend (5173) via Turborepo

  **Must NOT do**:
  - Do not add new features or routes
  - Do not fix "problems" by adding workarounds that violate guardrails
  - Do not add documentation files
  - Do not modify the database schema files
  - Do not install additional libraries not specified in Tasks 1-4
  - Do not add Shadcn UI components via `shadcn add` (that's for feature work)

  **Recommended Agent Profile**:
  - **Category**: `unspecified-low`
    - Reason: Integration testing and fix-up, systematic verification
  - **Skills**: `["playwright"]`
    - `playwright`: Needed for visual verification of frontend rendering
  - **Skills Evaluated but Omitted**:
    - `frontend-ui-ux`: Not needed — no design work, just verification
    - `git-master`: Not needed — simple commits

  **Parallelization**:
  - **Can Run In Parallel**: NO
  - **Parallel Group**: Wave 3 (solo, final)
  - **Blocks**: None (final task)
  - **Blocked By**: Tasks 2, 3, 4

  **References**:

  **Pattern References**:
  - `package.json` (root, created in Task 1) — Workspace scripts to run
  - `apps/backend/src/index.ts` (created in Task 3) — `type App` export for Eden Treaty
  - `apps/frontend/src/api/client.ts` (created in Task 4) — Eden Treaty client consuming backend types
  - `apps/frontend/vite.config.ts` (created in Task 4) — Proxy config for API requests

  **WHY Each Reference Matters**:
  - Root `package.json` — Turbo scripts must orchestrate all packages correctly
  - Backend `type App` — Eden Treaty depends on this type export being accessible from frontend workspace
  - Frontend `client.ts` — This is the critical type-safety bridge; if this compiles, E2E types work
  - `vite.config.ts` proxy — Dev workflow depends on this routing `/api` to backend

  **Acceptance Criteria**:

  **Agent-Executed QA Scenarios (MANDATORY):**

  ```
  Scenario: Full monorepo installs without errors
    Tool: Bash
    Preconditions: All tasks 1-4 completed
    Steps:
      1. cd /mnt/windows_data/Code/pttkpm/code && bun install
      2. Assert: Exit code 0
      3. Assert: No unresolved peer dependency errors for core packages
    Expected Result: Clean install across all workspaces
    Evidence: bun install output captured

  Scenario: TypeScript type-check passes across all workspaces
    Tool: Bash
    Preconditions: bun install completed
    Steps:
      1. bun run type-check
      2. Assert: Exit code 0 (turbo reports success for all packages)
    Expected Result: Zero type errors
    Evidence: turbo type-check output captured

  Scenario: Biome lint passes
    Tool: Bash
    Preconditions: bun install completed
    Steps:
      1. bun run lint
      2. Assert: Exit code 0
      3. Assert: No errors reported
    Expected Result: All code passes lint
    Evidence: biome output captured

  Scenario: Build completes for all packages
    Tool: Bash
    Preconditions: Type-check passes
    Steps:
      1. bun run build
      2. Assert: Exit code 0
      3. ls apps/backend/dist/ apps/frontend/dist/
      4. Assert: dist folders contain built files
    Expected Result: All packages build successfully
    Evidence: Build output + dist listing captured

  Scenario: Full dev environment starts (backend + frontend)
    Tool: Bash + Playwright
    Preconditions: bun install completed
    Steps:
      1. bun run dev &
      2. Wait 8 seconds for both servers to start
      3. curl -s http://localhost:3000/api/health
      4. Assert: Response contains {"status":"ok"}
      5. Navigate (Playwright) to http://localhost:5173
      6. Assert: Page loads with Vietnamese content
      7. Navigate to http://localhost:5173/login
      8. Assert: Login form renders with Vietnamese labels
      9. Screenshot: .sisyphus/evidence/task-5-full-integration.png
      10. kill %1
    Expected Result: Both servers running, frontend proxies to backend
    Evidence: .sisyphus/evidence/task-5-full-integration.png + curl output

  Scenario: Cross-package imports work
    Tool: Bash
    Preconditions: All packages created
    Steps:
      1. bun run type-check
      2. Assert: Backend can import from @hrms/shared (no module resolution errors)
      3. Assert: Frontend can import from @hrms/shared (no module resolution errors)
      4. Assert: Frontend Eden Treaty client compiles (type App resolves)
    Expected Result: All cross-package references resolve
    Evidence: Type-check output confirming zero errors
  ```

  **Evidence to Capture**:
  - [ ] Screenshots in `.sisyphus/evidence/` for frontend verification
  - [ ] Terminal output for all build/lint/type-check commands
  - [ ] Each evidence file named: `task-5-{scenario-slug}.{ext}`

  **Commit**: YES
  - Message: `chore(integration): verify monorepo setup, fix cross-package wiring`
  - Files: Any files modified during integration fixes
  - Pre-commit: `bun run type-check && bun run lint`

---

## Commit Strategy

| After Task | Message | Key Files | Verification |
|------------|---------|-----------|--------------|
| 1 | `chore(root): initialize monorepo infrastructure with Bun workspaces, Turborepo, and Biome` | package.json, turbo.json, biome.json, tsconfig.json | Config files exist |
| 2 | `feat(shared): add shared types and validators package with auth types and Zod schemas` | packages/shared/** | `tsc --noEmit` passes |
| 3 | `feat(backend): scaffold ElysiaJS app with full Drizzle ORM schema (30 tables), better-auth DB session auth, and example routes` | apps/backend/** | Server starts, health endpoint responds |
| 4 | `feat(frontend): scaffold React SPA with TanStack Router, Shadcn UI + Tailwind CSS v4, and Zustand store` | apps/frontend/** | Vite starts, pages render |
| 5 | `chore(integration): verify monorepo setup, fix cross-package wiring` | Any integration fixes | Full `bun run dev/build/lint/type-check` |

---

## Success Criteria

### Verification Commands
```bash
bun install           # Expected: exit 0, no errors
bun run type-check    # Expected: exit 0 across all workspaces
bun run lint          # Expected: exit 0, zero errors
bun run build         # Expected: exit 0, dist/ folders created
bun run dev           # Expected: backend on :3000, frontend on :5173
curl localhost:3000/api/health  # Expected: {"status":"ok","timestamp":"..."}
```

### Final Checklist
- [ ] All "Must Have" items present (workspaces, Turborepo, Biome, ElysiaJS, full Drizzle schema 30 tables, better-auth DB sessions with 30-min sliding expiry, TanStack Router, Shadcn UI + Tailwind CSS v4, react-hook-form, date-fns, Zustand, Eden Treaty)
- [ ] All "Must NOT Have" items absent (no Ant Design, no tailwind.config.js, no business logic, no tests, no Docker, no CI/CD)
- [ ] `bun install` → clean
- [ ] `bun run dev` → both servers start
- [ ] `bun run type-check` → zero errors
- [ ] `bun run lint` → zero errors
- [ ] `bun run build` → all packages build
- [ ] Shared types importable from both backend and frontend
- [ ] Eden Treaty client compiles with backend type inference
- [ ] Tailwind CSS v4 styles active in frontend (bg-background applied)
- [ ] Shadcn UI config (`components.json`) and `cn()` utility ready
- [ ] Existing `database/` files untouched
- [ ] All 30 tables from `database/schema.postgres.sql` converted to Drizzle TypeScript definitions
